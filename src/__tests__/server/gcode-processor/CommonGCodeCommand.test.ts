/**
 * @file CommonGCodeCommand.test.ts
 * @description
 *
 * @author Tom Glastonbury <t@tg73.net>
 * @license MIT
 * @copyright 2024
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
 * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
 * USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

import { parseCommonGCodeCommandLine } from '@/server/gcode-processor/CommonGCodeCommand';
import { test, expect } from 'vitest';

test.each([
	[''],
	[';'],
	['; blah blah blah'],

	['G00'],
	['G01'],
	['G10'],
	['G21'],
	['G31'],

	['T0', 'T', '0'],
	[' T0', 'T', '0'],
	[' T 0', 'T', '0'],
	[';T0'],
	['T5', 'T', '5'],
	['T1;2', 'T', '1'],
	['\tT\t3', 'T', '3'],

	['G1 X1.1', 'G', '1', '1.1'],
	['G1 Y1.1', 'G', '1', , '1.1'],
	['G1 E1.1', 'G', '1', , , '1.1'],
	['G1 Z1.1', 'G', '1', , , , '1.1'],
	['G1 F100', 'G', '1', , , , , '100'],

	['G1 X1.1 Y2.2 E3.3 Z4.4 F4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['G1 Y2.2 X1.1 E3.3 Z4.4 F4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['G1 E3.3 Y2.2 X1.1 Z4.4 F4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['G1 Z4.4 E3.3 Y2.2 X1.1 F4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['G1 F4321 Z4.4 E3.3 Y2.2 X1.1', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],

	[' G 1 X 1.1 Y 2.2 E 3.3 Z 4.4 F 4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	[' G 1 Y 2.2 X 1.1 E 3.3 Z 4.4 F 4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	[' G 1 E 3.3 Y 2.2 X 1.1 Z 4.4 F 4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	[' G 1 Z 4.4 E 3.3 Y 2.2 X 1.1 F 4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	[' G 1 F 4321 Z 4.4 E 3.3 Y 2.2 X 1.1', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],

	['  G  1  X  1.1  Y  2.2  E  3.3  Z  4.4  F  4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['  G  1  Y  2.2  X  1.1  E  3.3  Z  4.4  F  4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['  G  1  E  3.3  Y  2.2  X  1.1  Z  4.4  F  4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['  G  1  Z  4.4  E  3.3  Y  2.2  X  1.1  F  4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['  G  1  F  4321  Z  4.4  E  3.3  Y  2.2  X  1.1', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],

	['G1X1.1Y2.2E3.3Z4.4F4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['G1Y2.2X1.1E3.3Z4.4F4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['G1E3.3Y2.2X1.1Z4.4F4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['G1Z4.4E3.3Y2.2X1.1F4321', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],
	['G1F4321Z4.4E3.3Y2.2X1.1', 'G', '1', '1.1', '2.2', '3.3', '4.4', '4321'],

	['G1; X1.1 Y2.2 E3.3 Z4.4 F4321', 'G', '1'],
	['G1 X1.1; Y2.2 E3.3 Z4.4 F4321', 'G', '1', '1.1'],
	['G1 X1.1 Y2.2; E3.3 Z4.4 F4321', 'G', '1', '1.1', '2.2'],
	['G1 X1.1 Y2.2 E3.3; Z4.4 F4321', 'G', '1', '1.1', '2.2', '3.3'],
	['G1 X1.1 Y2.2 E3.3 Z4.4; F4321', 'G', '1', '1.1', '2.2', '3.3', '4.4'],

	['G1; F4321 Z4.4 E3.3 Y2.2 X1.1', 'G', '1', , , , , ,],
	['G1 F4321; Z4.4 E3.3 Y2.2 X1.1', 'G', '1', , , , , '4321'],
	['G1 F4321 Z4.4; E3.3 Y2.2 X1.1', 'G', '1', , , , '4.4', '4321'],
	['G1 F4321 Z4.4 E3.3; Y2.2 X1.1', 'G', '1', , , '3.3', '4.4', '4321'],
	['G1 F4321 Z4.4 E3.3 Y2.2; X1.1', 'G', '1', , '2.2', '3.3', '4.4', '4321'],

	// G0 normalizes to 'G' '1':
	['G0 X1.1', 'G', '1', '1.1'],

	['G2 X1.1', 'G', '2', '1.1'],
	['G2 Y1.1', 'G', '2', , '1.1'],
	['G2 E1.1', 'G', '2', , , '1.1'],
	['G2 Z1.1', 'G', '2', , , , '1.1'],
	['G2 F1.1', 'G', '2', , , , , '1.1'],
	['G2 I1.1', 'G', '2', , , , , , '1.1'],
	['G2 J1.1', 'G', '2', , , , , , , '1.1'],

	['G2 X1.1 Y2.2 I3.3 J4.4 E5.5 Z6.6 F700', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],

	['G2 X1.1 Y2.2 I3.3 J4.4 E5.5 Z6.6 F700', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],
	['G2 F700 X1.1 Y2.2 I3.3 J4.4 E5.5 Z6.6', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],
	['G2 Z6.6 F700 X1.1 Y2.2 I3.3 J4.4 E5.5', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],
	['G2 E5.5 Z6.6 F700 X1.1 Y2.2 I3.3 J4.4', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],
	['G2 J4.4 E5.5 Z6.6 F700 X1.1 Y2.2 I3.3', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],
	['G2 I3.3 J4.4 E5.5 Z6.6 F700 X1.1 Y2.2', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],
	['G2 Y2.2 I3.3 J4.4 E5.5 Z6.6 F700 X1.1', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],

	['G2X1.1Y2.2I3.3J4.4E5.5Z6.6F700', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],

	['G2 X1.1; Y2.2 I3.3 J4.4 E5.5 Z6.6 F700', 'G', '2', '1.1'],
	['G2 X1.1 Y2.2; I3.3 J4.4 E5.5 Z6.6 F700', 'G', '2', '1.1', '2.2'],
	['G2 X1.1 Y2.2 I3.3; J4.4 E5.5 Z6.6 F700', 'G', '2', '1.1', '2.2', , , , '3.3'],
	['G2 X1.1 Y2.2 I3.3 J4.4; E5.5 Z6.6 F700', 'G', '2', '1.1', '2.2', , , , '3.3', '4.4'],
	['G2 X1.1 Y2.2 I3.3 J4.4 E5.5; Z6.6 F700', 'G', '2', '1.1', '2.2', '5.5', , , '3.3', '4.4'],
	['G2 X1.1 Y2.2 I3.3 J4.4 E5.5 Z6.6; F700', 'G', '2', '1.1', '2.2', '5.5', '6.6', , '3.3', '4.4'],

	[' G2 X1.1 Y2.2 I3.3 J4.4 E5.5 Z6.6 F700', 'G', '2', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],

	['G3 X1.1 Y2.2 I3.3 J4.4 E5.5 Z6.6 F700', 'G', '3', '1.1', '2.2', '5.5', '6.6', '700', '3.3', '4.4'],
])(
	"'%s'",
	(
		input: string,
		cmd?: string,
		value?: string,
		x?: string,
		y?: string,
		e?: string,
		z?: string,
		f?: string,
		i?: string,
		j?: string,
	) => {
		const p = parseCommonGCodeCommandLine(input)!;
		if (cmd === undefined) {
			expect(p).toBeNull();
		} else {
			expect(p.letter).toStrictEqual(cmd);
			expect(p.value).toStrictEqual(value);
			expect(p.x).toStrictEqual(x);
			expect(p.y).toStrictEqual(y);
			expect(p.e).toStrictEqual(e);
			expect(p.z).toStrictEqual(z);
			expect(p.f).toStrictEqual(f);
			expect(p.i).toStrictEqual(i);
			expect(p.j).toStrictEqual(j);
		}
	},
);
